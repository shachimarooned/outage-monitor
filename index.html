<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Cloud Outage Monitor</title>
<style>
  :root{--red:#d83a3a;--orange:#d97706;--blue:#2563eb;--green:#15803d;--grey:#d0d7de}
  body{font:15px/1.4 system-ui,Segoe UI,Arial,sans-serif;background:#f6f8fa;margin:0;padding:1.2rem}
  h1{margin:0 0 1rem;font-size:1.4rem}
  #feed{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:.8rem}
  .card{background:#fff;border:1px solid var(--grey);border-left:6px solid var(--grey);
        border-radius:6px;padding:.7rem .9rem;box-shadow:0 1px 2px rgba(0,0,0,.04);min-height:110px}
  .card h2{margin:.1rem 0 .3rem;font-size:1rem}
  .card p{margin:.25rem 0}
  .err{color:var(--red);white-space:pre-line;font-size:.85rem}
  time{color:#61676d;font-size:.78rem}
</style>
</head>
<body>
<h1>Cloud Outage Monitor</h1>
<div id="feed"></div>

<script type="module">
/* 1 ─ feeds */
const FEEDS = {
  OpenAI        : 'https://status.openai.com/feed.rss',
  Anthropic     : 'https://status.anthropic.com/history.atom',
  AWS           : 'https://status.aws.amazon.com/rss/health.rss',
  Azure         : 'https://azurestatuscdn.azureedge.net/en-us/status/feed/',
  'Google Cloud': 'https://status.cloud.google.com/en/feed.atom',
  Slack         : 'https://slack-status.com/feed/rss',
  GitHub        : 'https://www.githubstatus.com/history.rss',
  Cloudflare    : 'https://www.cloudflarestatus.com/history.rss'
};

/* 2 ─ CORS helper */
const grab = async url => {
  for (const wrap of [
      u=>`https://cors.isomorphic-git.org/${u}`,
      u=>`https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`,
      u=>u
  ]){
    try{ return await (await fetch(wrap(url))).text(); }catch{}
  }
  throw new Error('Failed to fetch (blocked)');
};

/* 3 ─ tolerant first-item parser */
function firstItem(xml){
  const doc = new DOMParser().parseFromString(xml,'text/xml');
  const rss = doc.getElementsByTagName('item')[0];
  const atom= doc.getElementsByTagName('entry')[0];
  const node = rss || atom;
  if(!node) throw new Error('Unknown XML');

  const text = sel=>node.getElementsByTagName(sel)[0]?.textContent.trim()||'';
  const link =
     node.getElementsByTagName('link')[0]?.getAttribute('href') ||
     node.getElementsByTagName('link')[0]?.textContent.trim()    || '#';

  return {title:text('title')||'(no title)', link, date:text('updated')||text('published')||text('pubDate')};
}

/* 4 ─ severity → colour */
const colour = t=>{
  t=t.toLowerCase();
  if(/(major|outage|incident)/.test(t)) return 'var(--red)';
  if(/partial|degraded|disruption/.test(t)) return 'var(--orange)';
  if(/maintenance/.test(t)) return 'var(--blue)';
  if(/resolved|operational|closed/.test(t)) return 'var(--green)';
  return 'var(--grey)';
};

/* 5 ─ render */
const wrap=document.getElementById('feed');

for(const [name,url] of Object.entries(FEEDS)){
  const card=document.createElement('section');
  card.className='card';
  card.innerHTML=`<h2>${name}</h2><p>Loading…</p>`;
  wrap.appendChild(card);

  grab(url)
    .then(xml=>{
      const {title,link,date}=firstItem(xml);
      card.style.borderLeftColor = colour(title);
      card.innerHTML =
        `<h2>${name}</h2>
         <p><strong>${title}</strong></p>
         <time>${date?new Date(date).toLocaleString():''}</time><br>
         <a href="${link}" target="_blank" rel="noopener">details →</a>`;
    })
    .catch(e=>{
      card.style.borderLeftColor='var(--red)';
      card.innerHTML=`<h2>${name}</h2><p class="err">Couldn’t load feed\n${e.message}</p>`;
      console.error(name,e);
    });
}
</script>
</body>
</html>
